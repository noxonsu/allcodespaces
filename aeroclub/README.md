# Проект Аэроклуб

Этот проект состоит из React frontend приложения (`aeroclub-app`) и FastAPI backend приложения (`backend`).

## Структура проекта

```
aeroclub/
├── aeroclub-app/   # React Frontend
│   ├── public/
│   ├── src/
│   │   ├── components/
│   │   ├── App.tsx
│   │   └── index.tsx
│   ├── package.json
│   └── README.md   # README для frontend
└── backend/        # FastAPI Backend
    ├── app/
    │   ├── api/
    │   ├── core/
    │   ├── db_json/
    │   ├── services/
    │   ├── uploads/
    │   ├── crud.py
    │   ├── main.py
    │   └── models_db.py
    ├── tests/
    ├── .env
    ├── requirements.txt
    └── README.md   # README для backend
```

## Frontend (aeroclub-app)

Frontend - это React приложение, созданное с помощью Create React App и TypeScript.

### Основные функции:
*   **Страница входа**: Позволяет администраторам войти в систему.
*   **Страница администратора**: Предоставляет панель управления для:
    *   Пользователей (создание, просмотр - полный функционал списка ожидает endpoint на backend)
    *   Пунктов меню (загрузка новых напитков, редактирование существующих - ожидается интеграция с backend)
    *   Заказов (просмотр текущих заказов - ожидается интеграция с backend)
    *   Масштабирование/Локации (управление локациями, генерация QR-кодов - ожидается интеграция с backend)
*   **Страница клиентского приложения**: (Заготовка для клиентского приложения)

### Установка и запуск:

1.  **Перейдите в директорию frontend:**
    ```bash
    cd aeroclub/aeroclub-app
    ```
2.  **Установите зависимости:**
    ```bash
    npm install
    ```
3.  **Запустите сервер разработки:**
    ```bash
    npm start
    ```
    Приложение будет доступно по адресу `http://localhost:3000`.

### Взаимодействие с Backend API:
*   Страница входа (`src/components/LoginPage.tsx`) взаимодействует с endpoint `/api/v1/auth/token` backend для аутентификации.
*   Страница администратора (`src/components/AdminPage.tsx`) настроена для:
    *   Получения информации о пользователях (сейчас использует `/api/v1/users/me/` как заглушку для текущего пользователя, нужен полный endpoint списка пользователей `GET /api/v1/users/`).
    *   Создания новых пользователей через `POST /api/v1/users/`.
*   Другие функции страницы администратора (меню, заказы, локации) имеют элементы UI, но требуют дальнейшей интеграции с backend API. Базовый URL backend API жестко задан как `http://localhost:8000`.

## Backend (backend)

Backend - это FastAPI приложение.

### Основные функции:
*   **Аутентификация**: JWT-токен аутентификация (`/api/v1/auth/token`).
*   **Управление пользователями**:
    *   Создание пользователей (`POST /api/v1/users/`) - защищено для администратора.
    *   Получение текущего пользователя (`GET /api/v1/users/me/`).
    *   Первоначальная настройка администратора (`POST /api/v1/auth/setup-admin`).
*   **API Endpoints**: Организованы под `/api/v1/` для различных ресурсов (локации, пункты меню, заказы - подробности реализации в `backend/app/api/v1/endpoints/`).
*   **CORS включен**: Разрешает запросы со всех источников (`*`) для разработки.
*   **Обслуживание статических файлов**: Обслуживает загруженные файлы из `/uploads`.

### Установка и запуск:

1.  **Перейдите в директорию backend:**
    ```bash
    cd aeroclub/backend
    ```
2.  **Создайте виртуальное окружение (рекомендуется):**
    ```bash
    python -m venv venv
    source venv/bin/activate  # На Windows: venv\Scripts\activate
    ```
3.  **Установите зависимости:**
    ```bash
    pip install -r requirements.txt
    ```
4.  **Настройте переменные окружения:**
    Создайте файл `.env` в директории `aeroclub/backend`, скопировав `.env.example` (если существует) или создав его вручную.
    Он должен содержать как минимум:
    ```env
    SECRET_KEY=ваш_секретный_ключ
    ACCESS_TOKEN_EXPIRE_MINUTES=30
    ADMIN_USERNAME=ваш_админ_логин
    ADMIN_PASSWORD=ваш_админ_пароль
    # Опционально:
    # TELEGRAM_BOT_TOKEN=токен_вашего_телеграм_бота
    # TELEGRAM_CHAT_ID=id_вашего_телеграм_чата
    ```
5.  **Запустите сервер разработки:**
    ```bash
    uvicorn app.main:app --reload
    ```
    API будет доступно по адресу `http://localhost:8000`. Документация API находится по адресам `http://localhost:8000/docs` и `http://localhost:8000/redoc`.

## Подключение Frontend к Backend

*   Frontend ожидает, что backend API работает на `http://localhost:8000`.
*   Backend настроен с CORS для разрешения запросов с `http://localhost:3000` (и других распространенных портов разработки, или `*` для открытого доступа во время разработки).
*   Компонент `LoginPage.tsx` во frontend делает `POST` запрос к `http://localhost:8000/api/v1/auth/token` для аутентификации.
*   Компонент `AdminPage.tsx` во frontend делает запросы к:
    *   `POST http://localhost:8000/api/v1/users/` для создания пользователей.
    *   `GET http://localhost:8000/api/v1/users/me/` для получения данных текущего пользователя (как заглушка для полного списка пользователей, в то время как `GET /api/v1/users/` ожидается для получения полного списка пользователей).
*   Для раздела **Заказы** в `AdminPage.tsx`, можно начать интеграцию со следующими эндпоинтами backend:
    *   `GET http://localhost:8000/api/v1/orders/` для получения списка заказов (требует аутентификации).
    *   `GET http://localhost:8000/api/v1/orders/{order_id}` для получения конкретного заказа (требует аутентификации).
    *   `PUT http://localhost:8000/api/v1/orders/{order_id}/status` для обновления статуса заказа (требует аутентификации администратора).
    *   `POST http://localhost:8000/api/v1/orders/` для создания новых заказов (текущая реализация не требует аутентификации, так как рассчитана на Telegram бота; для использования администратором может потребоваться доработка или отдельный эндпоинт/проверка прав).

## Дальнейшая разработка и задачи

### Frontend:
*   Реализовать API вызовы для всех CRUD операций на странице администратора:
    *   **Заказы**: Интегрировать просмотр списка заказов (`GET /api/v1/orders/`), просмотр деталей заказа (`GET /api/v1/orders/{order_id}`) и обновление статуса заказа (`PUT /api/v1/orders/{order_id}/status`). Рассмотреть создание заказов (`POST /api/v1/orders/`) с учетом текущей логики аутентификации эндпоинта.
    *   **Меню**: Интегрировать CRUD операции.
    *   **Локации**: Интегрировать CRUD операции.
*   Заменить mock данные на данные, получаемые с backend для всех разделов.
*   Реализовать правильную обработку ошибок и состояний загрузки для всех API взаимодействий.
*   Разработать страницу клиентского приложения.
*   Добавить функциональность редактирования и удаления пользователей.
*   Защитить маршруты администратора, обеспечив доступ только аутентифицированным пользователям.
*   Реализовать функциональность выхода из системы.

### Backend:
*   Реализовать `GET /api/v1/users/` для получения списка всех пользователей (защищено для администратора).
*   Реализовать `PUT /api/v1/users/{user_id}` и `DELETE /api/v1/users/{user_id}` для управления пользователями.
*   Полностью реализовать CRUD операции для endpoints `locations` и `menu_items`. Эндпоинты для `orders` частично реализованы и готовы к интеграции (см. задачи Frontend).
*   Рассмотреть необходимость аутентификации для `POST /api/v1/orders/` при использовании из админ-панели.
*   Улучшить взаимодействие с базой данных (сейчас JSON файлы, рассмотреть более надежную базу данных как PostgreSQL или SQLite для продакшена).
*   Добавить более комплексные тесты.
*   Улучшить безопасность, особенно для продакшена (например, более специфичные CORS источники).

Этот `README.md` предоставляет общий обзор. Для более конкретных деталей обратитесь к файлам `README.md` в директориях `aeroclub-app` и `backend`.

## Быстрый запуск

Для запуска проекта выполните следующие команды:

### Запуск Backend:
```bash
cd aeroclub/backend
python -m venv venv
source venv/bin/activate  # На Windows: venv\Scripts\activate
pip install -r requirements.txt
# Создайте файл .env с необходимыми переменными
uvicorn app.main:app --reload
```

### Запуск Frontend:
```bash
cd aeroclub/aeroclub-app
npm install
npm start
```

После запуска:
- Backend будет доступен на `http://localhost:8000`
- Frontend будет доступен на `http://localhost:3000`
- API документация: `http://localhost:8000/docs`
