# Запуск HR-бота с GramJS (Node.js User Client)

Этот документ описывает, как настроить и запустить HR-бота, который использует единый Node.js скрипт (`allcdsp_gpts_hr.js`) для основной логики и взаимодействия с Telegram от имени обычного пользователя (через библиотеку GramJS).

**Важно:** Эта версия скрипта работает **только** от имени пользователя Telegram через GramJS. Функционал стандартного Telegram-бота (через Bot API) был удален для упрощения.

## Обзор

Скрипт `allcdsp_gpts_hr.js` теперь содержит:
*   Основную логику бота (взаимодействие с LLM, управление данными пользователей и т.д.).
*   Инициализацию, логику входа и обработчики для GramJS `TelegramClient` (требуются `TELEGRAM_API_ID`, `TELEGRAM_API_HASH`).
*   Общую функцию `handleIncomingMessage` для обработки сообщений, поступающих от GramJS клиента.
*   Express-сервер для отображения логов (если настроено `ADMIN_TELEGRAM_ID` и `BOT_SERVER_BASE_URL`).

## Требования

Перед началом убедитесь, что у вас установлены:
*   Node.js (версия 16.x или выше рекомендуется)
*   npm (обычно устанавливается вместе с Node.js)

## 1. Установка зависимостей

Откройте терминал в корневой директории проекта (где находится файл `package.json`) и выполните команду:
```bash
npm install
```
Эта команда установит все необходимые пакеты, включая `express`, `dotenv`, `telegram` (GramJS), и `input` (для консольного ввода).

## 2. Конфигурация

Все настройки хранятся в файле `.env.hr` в директории `gpts/` (или `.env.{NAMEPROMPT}` если переменная окружения `NAMEPROMPT` установлена иначе).

Откройте файл `gpts/.env.hr` и настройте следующие переменные для GramJS:

```dotenv
# GramJS User Account Configuration
TELEGRAM_API_ID="YOUR_API_ID_HERE" # Получить с my.telegram.org
TELEGRAM_API_HASH="YOUR_API_HASH_HERE" # Получить с my.telegram.org
TELEGRAM_PHONE_NUMBER="YOUR_PHONE_NUMBER_WITH_COUNTRY_CODE" # Например, +12345678900

# Строка сессии TELEGRAM_SESSION_STRING будет выведена в консоль при первом запуске.
# Скопируйте ее из консоли и вставьте сюда, затем раскомментируйте строку.
# TELEGRAM_SESSION_STRING="" 

# --- Остальные настройки ---
OPENAI_API_KEY="ВАШ_OPENAI_КЛЮЧ"
# DEEPSEEK_API_KEY="ВАШ_DEEPSEEK_КЛЮЧ" # Если используется
MODEL="openai" # или "deepseek"
# OPENAIMODEL="gpt-4.1" # Если используется OpenAI

ADMIN_TELEGRAM_ID="ВАШ_ТЕЛЕГРАМ_ID_АДМИНА" # ID пользователя для уведомлений
BOT_SERVER_BASE_URL="URL_ВАШЕГО_СЕРВЕРА_ЛОГОВ" # Например, http://yourdomain.com:15656
```

**Важно для GramJS:**
*   Замените `"YOUR_API_ID_HERE"`, `"YOUR_API_HASH_HERE"` и `"YOUR_PHONE_NUMBER_WITH_COUNTRY_CODE"` на ваши реальные данные. `API_ID` и `API_HASH` можно получить на сайте [my.telegram.org](https://my.telegram.org) -> "API development tools".
*   `TELEGRAM_SESSION_STRING`: Эта переменная изначально должна быть пустой или закомментированной. При первом успешном запуске скрипт выведет в консоль сгенерированную строку сессии. Вам нужно будет скопировать эту строку, вставить ее значение в `.env.hr` и раскомментировать. Это позволит избежать повторного ввода кода из Telegram при последующих запусках.
*   `ADMIN_TELEGRAM_ID`: Если указан, уведомления администратору будут отправляться с вашего пользовательского аккаунта на этот ID пользователя.

**Переменная `TELEGRAM_BOT_TOKEN` больше не используется в этом скрипте.**

## 3. Запуск системы

Откройте терминал в корневой директории проекта и выполните:
```bash
node gpts/allcdsp_gpts_hr.js
```

**Поведение при запуске:**
*   Скрипт попытается инициализировать и запустить GramJS `TelegramClient`.
    *   **При первом запуске (если `TELEGRAM_SESSION_STRING` не задана в `.env.hr`):**
        *   Если `TELEGRAM_PHONE_NUMBER` не указан в `.env.hr`, вас попросят ввести номер телефона в консоли.
        *   Затем вас попросят ввести код подтверждения, который Telegram отправит на указанный аккаунт.
        *   Если у вас включена двухфакторная аутентификация (2FA), вас также попросят ввести пароль.
        *   После успешного входа скрипт выведет в консоль строку `TELEGRAM_SESSION_STRING`. **Обязательно скопируйте эту строку, вставьте ее в файл `gpts/.env.hr` и раскомментируйте соответствующую строку.** Затем перезапустите скрипт (`node gpts/allcdsp_gpts_hr.js`).
    *   **При последующих запусках (с валидной `TELEGRAM_SESSION_STRING`):**
        *   GramJS клиент должен подключиться автоматически без запроса кода.

После успешного запуска скрипт будет обрабатывать сообщения, поступающие на аккаунт пользователя, указанный при настройке GramJS.

## Как это работает (кратко)

1.  Пользователь отправляет сообщение на ваш Telegram-аккаунт (тот, что настроен в GramJS).
2.  GramJS клиент в `allcdsp_gpts_hr.js` получает это сообщение.
3.  Данные сообщения (текст, информация об отправителе) передаются в функцию `handleIncomingMessage` внутри того же скрипта.
4.  `handleIncomingMessage` обрабатывает сообщение, используя основную логику бота (включая вызовы LLM, работу с данными пользователя и т.д.).
5.  `handleIncomingMessage` возвращает результат, указывающий, какое действие предпринять (например, отправить ответное сообщение).
6.  Скрипт отправляет ответное сообщение через GramJS клиент от имени вашего аккаунта.

---
Если возникнут проблемы, проверьте сообщения в консоли – они могут содержать полезную информацию об ошибках.
